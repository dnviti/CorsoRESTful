DROP TABLE ShopsMovies;
DROP TABLE Shops;
DROP TABLE Authors;
DROP TABLE ActorsMovies;
DROP TABLE Actors;
DROP TABLE Movies;

CREATE TABLE Movies
(
	Id INT IDENTITY(1,1) PRIMARY KEY,
	Name VARCHAR(255) NOT NULL,
	Rating double NOT NULL,
	AuthorId INT NULL,
	ReleaseDate DATETIME2 NULL,
	CreatedOn DATETIME2 NULL,
	ModifiedOn DATETIME2 NULL
);

CREATE TABLE Actors
(
	Id INT IDENTITY(1,1) PRIMARY KEY,
	Name VARCHAR(255) NOT NULL,
	Surname VARCHAR(255) NOT NULL, 
    BirthDate DATETIME2 NULL,
	Role INT NOT NULL
);

CREATE TABLE ActorsMovies
(
	ActorId INT NOT NULL,
	MovieId INT NOT NULL,
	CONSTRAINT ActorsMovies_UN UNIQUE (ActorId,MovieId),
	CONSTRAINT FK1_ActorsMovies FOREIGN KEY (ActorId)
	REFERENCES Movies(Id)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
	CONSTRAINT FK2_ActorsMovies FOREIGN KEY (MovieId)
	REFERENCES Movies(Id)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION
);

CREATE TABLE Authors
(
	Id INT IDENTITY(1,1) PRIMARY KEY,
	Name VARCHAR(255) NOT NULL,
	Surname VARCHAR(255) NOT NULL, 
    BirthDate DATETIME2 NULL,
	Role INT NOT NULL,
	MovieId INT NULL,
	CONSTRAINT FK1_Authors FOREIGN KEY (MovieId)
	REFERENCES Movies(Id)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION
);

CREATE TABLE Shops
(
	Id INT IDENTITY(1,1) PRIMARY KEY,
	Name VARCHAR(255) NOT NULL
);

CREATE TABLE ShopsMovies
(
	ShopId INT NOT NULL,
	MovieId INT NOT NULL,
	CONSTRAINT ShopsMovies_UN UNIQUE (ShopId,MovieId),
	CONSTRAINT FK1_ShopsMovies FOREIGN KEY (ShopId)
	REFERENCES Shops(Id)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
	CONSTRAINT FK2_ShopsMovies FOREIGN KEY (MovieId)
	REFERENCES Movies(Id)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION
);